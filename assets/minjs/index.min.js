function Index(){return this instanceof Index?void this.init():new Index}Index.prototype={init:function(){this.initGloDOMs(),this.fetchAllPeriods(!0)},fetchAllPeriods:function(t){var e=this;$.hkAjax("get","/periods",{},function(i){console.log(i),e.sortByTimestamp(i),e.renderPeriodList(i),t&&(e.clickStatusEvent(),e.initBodyEvent(),e.newPeriodBtnEvent())})},newPeriodBtnEvent:function(){var t=this;$(".new-period-btn").on("click",function(){var e=$(this).siblings("input[name='new-period-start']").val(),i=$(this).siblings("input[name='new-period-end']").val();t.checkDate(e,i)&&t.postNewPeriod(e,i)})},checkDate:function(t,e){return t&&""!=t.trim()?!(!e||""==e.trim())||(alert("请输入结束日期"),!1):(alert("请输入开始日期"),!1)},initBodyEvent:function(){$(".period-wrapper").click(function(){}),document.body.addEventListener("click",function(){$(".dropdown-menu").hide()},!0)},clickStatusEvent:function(){var t=this;$periodWrapper.on("click",".result span",function(){var e=$(this),i=$(this).parent().attr("data-noteid"),n=function(){e.addClass("active").siblings().removeClass("active")};if(e.hasClass("pending"))t.postNoteResultClick(i,2,n);else if(e.hasClass("success"))t.postNoteResultClick(i,1,n);else{if(!e.hasClass("fail"))throw new Error("result click exception!");t.postNoteResultClick(i,0,n)}}).on("click",".new-todo-btn",function(){var e=$(this).attr("data-periodid");t.addNewTodo(e)}).on("click",".new-diary-btn",function(){var e=$(this).attr("data-periodid");t.addNewDiary(e)}).on("click",".icon-config",function(){$(this).attr("data-noteid");$(".dropdown-menu").hide();$(this).siblings(".dropdown-menu").show()}).on("click",".todolist .dropdown-menu .del",function(){$(this).parent().hide();var e=$(this).attr("data-noteid");t.deleteTodo(e)}).on("click",".diarylist .dropdown-menu .del",function(){$(this).parent().hide();var e=$(this).attr("data-diaryid");t.deleteDiary(e)}).on("click",".todolist .dropdown-menu .rename",function(){var e=$(this).attr("data-noteid"),i=$(this).parent().parent().parent(),n=i.find(".editable"),o=i.find(".non-editable");setTimeout(function(){n.find("input").select(),n.find("input").focus()},100),o.hide(),n.show(),n.find("input").off("blur"),n.find("input").on("blur",function(){o.html($(this).val()).show(),n.hide();var i=$(this).val();t.renameTodo(e,i)})}).on("click",".period .period-del-btn",function(){var e=$(this).attr("data-periodid");t.deletePeriod(e)}).on("click",".period .period-update-btn",function(){var e=$(this).attr("data-periodid"),i=$(this).siblings("input[name='period-start']").val(),n=$(this).siblings("input[name='period-end']").val();t.checkDate(i,n)&&t.updatePeriod(e,i,n)})},addNewTodo:function(t){var e=this,i=$(".todolist[data-periodid='"+t+"']"),n={title:"title",result:2},o=template("tpl-todo-item",n);i.append(o);var d=i.children().last();d.find(".non-editable").hide().end().find(".editable").show().find("input").select(),d.find("input").on("blur",function(){d.find(".non-editable").html($(this).val()).show().end().find(".editable").hide();var i=$(this).val(),n={title:i,periodId:t};e.postNewTodo(n)})},addNewDiary:function(t){var e=this,i=$(".diarylist[data-periodid='"+t+"']"),n={title:"title"},o=template("tpl-diary-item",n);i.append(o);var d=i.children().last();d.find(".non-editable").hide().end().find(".editable").show().find("input").select(),d.find("input").on("blur",function(){d.find(".non-editable").html($(this).val()).show().end().find(".editable").hide();var i=$(this).val(),n={title:i,periodId:t};e.postNewDiary(n)})},postNewPeriod:function(t,e){var i=this;$.hkAjax("post","/periods/addperiod",{startDate:t,endDate:e},function(t){$.hkPopupTip(t,2e3),i.fetchAllPeriods()},"text")},postNewTodo:function(t){var e=this;$.hkAjax("post","/notes/addnote",t,function(t){$.hkPopupTip(t,2e3),e.fetchAllPeriods()},"text")},postNewDiary:function(t){var e=this;$.hkAjax("post","/diaries/adddiary",t,function(t){$.hkPopupTip(t,2e3),e.fetchAllPeriods()},"text")},postNoteResultClick:function(t,e,i){$.hkAjax("post","/notes/changenotestatus",{noteId:t,status:e},function(t){$.hkPopupTip(t,2e3),console.log("post note result click res:",t),i()},"text")},updatePeriod:function(t,e,i){var n=this;$.hkAjax("post","/periods/updateperiod",{periodId:t,startDate:e,endDate:i},function(t){$.hkPopupTip(t,2e3),n.fetchAllPeriods()},"text")},deletePeriod:function(t){var e=this;$.hkAjax("post","/periods/deleteperiod",{periodId:t},function(t){$.hkPopupTip(t,2e3),e.fetchAllPeriods()},"text")},deleteTodo:function(t){var e=this;$.hkAjax("post","/notes/deletenote",{noteId:t},function(t){$.hkPopupTip(t,2e3),e.fetchAllPeriods()},"text")},deleteDiary:function(t){var e=this;$.hkAjax("post","/diaries/deletediary",{diaryId:t},function(t){$.hkPopupTip(t,2e3),e.fetchAllPeriods()},"text")},renameTodo:function(t,e){var i=this;$.hkAjax("post","/notes/renamenote",{noteId:t,title:e},function(t){$.hkPopupTip(t,2e3),i.fetchAllPeriods()},"text")},sortByTimestamp:function(t){for(var e=t.periods.length,i=0;i<e;i++)t.periods[i].notes.sort(function(t,e){return e.createdDate-t.createdDate})},renderPeriodList:function(t){this.formatDate(t);var e=template("tpl-period-list",t);$periodWrapper.html(e)},initGloDOMs:function(){$main=$("main"),$periodWrapper=$main.find(".period-wrapper")},formatDate:function(t){if(t&&t.periods)for(var e=t.periods.length,i=0;i<e;i++)if(t.periods[i].startedDate=this.getDateByTimeStamp(t.periods[i].startedDate),t.periods[i].endedDate=this.getDateByTimeStamp(t.periods[i].endedDate),t.periods[i].diaries&&t.periods[i].diaries.length>0)for(var n=t.periods[i].diaries.length,o=0;o<n;o++)t.periods[i].diaries[o].createdDate=this.getDateByTimeStampWithDash(t.periods[i].diaries[o].createdDate)},getDateByTimeStamp:function(t){var t=parseInt(t);t=isNaN(t)?0:t;var e=new Date(t),i=e.getFullYear(),n=this.twoDigits(e.getMonth()+1),o=this.twoDigits(e.getDate());return i+"-"+n+"-"+o},getDateByTimeStampWithDash:function(t){var t=parseInt(t);t=isNaN(t)?0:t;var e=new Date(t),i=e.getFullYear(),n=this.twoDigits(e.getMonth()+1),o=this.twoDigits(e.getDate()),d=this.twoDigits(e.getHours()),a=this.twoDigits(e.getMinutes()),r=this.twoDigits(e.getSeconds());return i+"-"+n+"-"+o+" "+d+":"+a+":"+r},twoDigits:function(t){return t>=10?t:"0"+t}},Object.defineProperty(Index.prototype,"constructor",{enumerable:!1,value:Index}),$(function(){new Index});